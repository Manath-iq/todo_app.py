<!doctype html>
<html lang="ru">
  <head>
    <meta charset="utf-8" />
    <title>ToDo</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      body { max-width: 700px; margin: 2rem auto; font-family: system-ui, sans-serif; }
      h1 { margin-bottom: .5rem; }
      form { display: flex; gap: .5rem; margin: 1rem 0; }
      input[type="text"] { flex: 1; padding: .5rem; }
      button { padding: .5rem 1rem; cursor: pointer; }
      .row { display: flex; gap: .75rem; align-items: center; flex-wrap: wrap; }
      .tabs { display: flex; gap: .5rem; margin: .5rem 0 1rem; }
      .tab { padding: .35rem .7rem; border: 1px solid #ccc; border-radius: .4rem; text-decoration: none; color: inherit; }
      .tab.active { background: #eee; font-weight: 600; }
      ul { padding-left: 1.2rem; }
      li { display: flex; align-items: center; gap: .5rem; margin: .3rem 0; }
      .done { text-decoration: line-through; opacity: .7; }
      .muted { opacity: .7; font-size: .9rem; }
      .grow { flex: 1; }
    </style>
  </head>
  <body>
    <h1>Мои задачи</h1>

    <div class="row">
      <form method="post" class="grow">
        <input name="title" type="text" placeholder="Новая задача..." required />
        <button type="submit">Добавить</button>
      </form>

      <form method="get">
        <input type="hidden" name="filter" value="{{ flt }}">
        <input name="q" type="text" value="{{ qtext }}" placeholder="Поиск по названию" />
        <button type="submit">Найти</button>
      </form>
    </div>

    <div class="tabs">
      <a class="tab {{ 'active' if flt == 'all' }}" href="{{ url_for('index', filter='all', q=qtext) }}">Все ({{ totals.all }})</a>
      <a class="tab {{ 'active' if flt == 'active' }}" href="{{ url_for('index', filter='active', q=qtext) }}">Активные ({{ totals.active }})</a>
      <a class="tab {{ 'active' if flt == 'done' }}" href="{{ url_for('index', filter='done', q=qtext) }}">Выполненные ({{ totals.done }})</a>
    </div>

    {% if tasks %}
      <ul>
        {% for t in tasks %}
          <li>
            <form method="post" action="{{ url_for('toggle', task_id=t.id) }}" style="display:inline">
              <button title="Отметить выполненной/не выполненной">✓</button>
            </form>
            <span class="{{ 'done' if t.done }}">{{ t.title }}</span>
            <form method="post" action="{{ url_for('delete', task_id=t.id) }}" style="display:inline;margin-left:auto">
              <button title="Удалить">✕</button>
            </form>
          </li>
        {% endfor %}
      </ul>
    {% else %}
      <p class="muted">Ничего не найдено.</p>
    {% endif %}
  </body>
</html>
